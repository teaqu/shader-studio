"use strict";function piCamera(){var e=setIdentity(),t=setIdentity(),r=[0,0,0],n=0,E=0,i=[0,0,0],T=0,a=0,R={SetPos:function(e){r=e},LocalMove:function(e){e=matMulvec(setRotationY(-E),e),i=sub(i,e)},RotateXY:function(e,t){T-=e,a-=t,T=Math.min(Math.max(T,-Math.PI/2),Math.PI/2)},CameraExectue:function(R){n+=12*(T-n)*R,E+=12*(a-E)*R,r=add(r,mul(sub(i,r),12*R)),e=matMul(matMul(setRotationX(n),setRotationY(E)),setTranslation(r)),t=invertFast(e)},GetMatrix:function(){return e},GetMatrixInverse:function(){return t},SetMatrix:function(n){t=invertFast(e=n),r=getXYZ(matMulpoint(n,[0,0,0])),i=r},GetPos:function(){return getXYZ(matMulpoint(t,[0,0,0]))},GetDir:function(){return getXYZ(normalize(matMulvec(t,[0,0,-1])))}};return R}function piFile(e){var t=0,r=new DataView(e),n=e,E={Seek:function(e){t=e},Tell:function(){return t},Skip:function(e){t+=e},ReadUInt16:function(){var e=r.getUint16(t,!0);return t+=2,e},ReadUInt32:function(){var e=r.getUint32(t,!0);return t+=4,e},ReadUInt64:function(){return E.ReadUInt32()+(E.ReadUInt32()<<32)},ReadFloat32:function(){var e=r.getFloat32(t,!0);return t+=4,e},ReadFloat32Array:function(e){for(var r=new Float32Array(n,t),E=[],i=0;i<e;i++)E[i]=r[i];return t+=4*e,E},ReadFloat32ArrayNative:function(e){var r=new Float32Array(n,t);return t+=4*e,r}};return E}function piExportToEXR(e,t,r,n,E){var i=0;"Uint"==n?i=4:"Half"==n?i=2:"Float"==n&&(i=4);var T=new ArrayBuffer(18*r+1+258+8*t+t*(8+r*i*e)),a=new DataView(T),R=0;a.setUint8(R++,118),a.setUint8(R++,47),a.setUint8(R++,49),a.setUint8(R++,1),a.setUint8(R++,2),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,99),a.setUint8(R++,104),a.setUint8(R++,97),a.setUint8(R++,110),a.setUint8(R++,110),a.setUint8(R++,101),a.setUint8(R++,108),a.setUint8(R++,115),a.setUint8(R++,0),a.setUint8(R++,99),a.setUint8(R++,104),a.setUint8(R++,108),a.setUint8(R++,105),a.setUint8(R++,115),a.setUint8(R++,116),a.setUint8(R++,0);var m,u=18*r+1;for(a.setUint8(R++,u),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),m=0;m<r;m++)0==m?a.setUint8(R++,66):1==m?a.setUint8(R++,71):2==m&&a.setUint8(R++,82),a.setUint8(R++,0),"Uint"==n?a.setUint8(R++,0):"Half"==n?a.setUint8(R++,1):"Float"==n&&a.setUint8(R++,2),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,1),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,1),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,1),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0);a.setUint8(R++,0),a.setUint8(R++,99),a.setUint8(R++,111),a.setUint8(R++,109),a.setUint8(R++,112),a.setUint8(R++,114),a.setUint8(R++,101),a.setUint8(R++,115),a.setUint8(R++,115),a.setUint8(R++,105),a.setUint8(R++,111),a.setUint8(R++,110),a.setUint8(R++,0),a.setUint8(R++,99),a.setUint8(R++,111),a.setUint8(R++,109),a.setUint8(R++,112),a.setUint8(R++,114),a.setUint8(R++,101),a.setUint8(R++,115),a.setUint8(R++,115),a.setUint8(R++,105),a.setUint8(R++,111),a.setUint8(R++,110),a.setUint8(R++,0),a.setUint8(R++,1),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,100),a.setUint8(R++,97),a.setUint8(R++,116),a.setUint8(R++,97),a.setUint8(R++,87),a.setUint8(R++,105),a.setUint8(R++,110),a.setUint8(R++,100),a.setUint8(R++,111),a.setUint8(R++,119),a.setUint8(R++,0),a.setUint8(R++,98),a.setUint8(R++,111),a.setUint8(R++,120),a.setUint8(R++,50),a.setUint8(R++,105),a.setUint8(R++,0),a.setUint8(R++,16),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint32(R,e-1,!0),R+=4,a.setUint32(R,t-1,!0),R+=4,a.setUint8(R++,100),a.setUint8(R++,105),a.setUint8(R++,115),a.setUint8(R++,112),a.setUint8(R++,108),a.setUint8(R++,97),a.setUint8(R++,121),a.setUint8(R++,87),a.setUint8(R++,105),a.setUint8(R++,110),a.setUint8(R++,100),a.setUint8(R++,111),a.setUint8(R++,119),a.setUint8(R++,0),a.setUint8(R++,98),a.setUint8(R++,111),a.setUint8(R++,120),a.setUint8(R++,50),a.setUint8(R++,105),a.setUint8(R++,0),a.setUint8(R++,16),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint32(R,e-1,!0),R+=4,a.setUint32(R,t-1,!0),R+=4,a.setUint8(R++,108),a.setUint8(R++,105),a.setUint8(R++,110),a.setUint8(R++,101),a.setUint8(R++,79),a.setUint8(R++,114),a.setUint8(R++,100),a.setUint8(R++,101),a.setUint8(R++,114),a.setUint8(R++,0),a.setUint8(R++,108),a.setUint8(R++,105),a.setUint8(R++,110),a.setUint8(R++,101),a.setUint8(R++,79),a.setUint8(R++,114),a.setUint8(R++,100),a.setUint8(R++,101),a.setUint8(R++,114),a.setUint8(R++,0),a.setUint8(R++,1),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,112),a.setUint8(R++,105),a.setUint8(R++,120),a.setUint8(R++,101),a.setUint8(R++,108),a.setUint8(R++,65),a.setUint8(R++,115),a.setUint8(R++,112),a.setUint8(R++,101),a.setUint8(R++,99),a.setUint8(R++,116),a.setUint8(R++,82),a.setUint8(R++,97),a.setUint8(R++,116),a.setUint8(R++,105),a.setUint8(R++,111),a.setUint8(R++,0),a.setUint8(R++,102),a.setUint8(R++,108),a.setUint8(R++,111),a.setUint8(R++,97),a.setUint8(R++,116),a.setUint8(R++,0),a.setUint8(R++,4),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,128),a.setUint8(R++,63),a.setUint8(R++,115),a.setUint8(R++,99),a.setUint8(R++,114),a.setUint8(R++,101),a.setUint8(R++,101),a.setUint8(R++,110),a.setUint8(R++,87),a.setUint8(R++,105),a.setUint8(R++,110),a.setUint8(R++,100),a.setUint8(R++,111),a.setUint8(R++,119),a.setUint8(R++,67),a.setUint8(R++,101),a.setUint8(R++,110),a.setUint8(R++,116),a.setUint8(R++,101),a.setUint8(R++,114),a.setUint8(R++,0),a.setUint8(R++,118),a.setUint8(R++,50),a.setUint8(R++,102),a.setUint8(R++,0),a.setUint8(R++,8),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,115),a.setUint8(R++,99),a.setUint8(R++,114),a.setUint8(R++,101),a.setUint8(R++,101),a.setUint8(R++,110),a.setUint8(R++,87),a.setUint8(R++,105),a.setUint8(R++,110),a.setUint8(R++,100),a.setUint8(R++,111),a.setUint8(R++,119),a.setUint8(R++,87),a.setUint8(R++,105),a.setUint8(R++,100),a.setUint8(R++,116),a.setUint8(R++,104),a.setUint8(R++,0),a.setUint8(R++,102),a.setUint8(R++,108),a.setUint8(R++,111),a.setUint8(R++,97),a.setUint8(R++,116),a.setUint8(R++,0),a.setUint8(R++,4),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,0),a.setUint8(R++,128),a.setUint8(R++,63),a.setUint8(R++,0);for(var U=R+8*t,o=0;o<t;o++){var s=U+o*(8+e*i*r);a.setUint32(R,s,!0),R+=4,a.setUint32(R,0,!0),R+=4}for(o=0;o<t;o++){a.setUint32(R,o,!0),R+=4;var l=e*r*i;a.setUint32(R,l,!0),R+=4;for(var _=0;_<r;_++)for(var A=0;A<e;A++){var f=E[(t-1-o)*e*4+4*A+(2-_)];"Float"==n?a.setFloat32(R,f,!0):"Half"==n&&a.setUint16(R,f,!0),R+=i}}return new Blob([T],{type:"application/octet-stream"})}function piExportToWAV(e,t,r,n,E){let i=e*n*r/8,T=new ArrayBuffer(44+i),a=new DataView(T);a.setUint32(0,1179011410,!0),a.setUint32(4,i+36,!0),a.setUint32(8,1163280727,!0),a.setUint32(12,544501094,!0),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,n,!0),a.setUint32(24,t,!0),a.setUint32(28,t*n*r/8,!0),a.setUint16(32,n*r/8,!0),a.setUint16(34,r,!0),a.setUint32(36,1635017060,!0);{a.setUint32(40,i,!0);let t=e*n;for(let e=0;e<t;e++)a.setInt16(44+2*e,E[e],!0)}return new Blob([T],{type:"application/octet-stream"})}function piMesh(){this.mChunks=[],this.mPrimitiveType=0,this.mVertexFormat=null}function piRenderer(){var e,t,r=null,n=null,E=null,i=null,T=null,a=null,R=["",""],m=[0,0],u={CLEAR:{Color:1,Zbuffer:2,Stencil:4},TEXFMT:{C4I8:0,C1I8:1,C1F16:2,C4F16:3,C1F32:4,C4F32:5,Z16:6,Z24:7,Z32:8},TEXWRP:{CLAMP:0,REPEAT:1},BUFTYPE:{STATIC:0,DYNAMIC:1},PRIMTYPE:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5},RENDSTGATE:{WIREFRAME:0,FRONT_FACE:1,CULL_FACE:2,DEPTH_TEST:3,ALPHA_TO_COVERAGE:4},TEXTYPE:{T2D:0,T3D:1,CUBEMAP:2},FILTER:{NONE:0,LINEAR:1,MIPMAP:2,NONE_MIPMAP:3},TYPE:{UINT8:0,UINT16:1,UINT32:2,FLOAT16:3,FLOAT32:4,FLOAT64:5}};let U=function(e){return e===u.TEXFMT.C4I8?{mGLFormat:r.RGBA8,mGLExternal:r.RGBA,mGLType:r.UNSIGNED_BYTE}:e===u.TEXFMT.C1I8?{mGLFormat:r.R8,mGLExternal:r.RED,mGLType:r.UNSIGNED_BYTE}:e===u.TEXFMT.C1F16?{mGLFormat:r.R16F,mGLExternal:r.RED,mGLType:r.FLOAT}:e===u.TEXFMT.C4F16?{mGLFormat:r.RGBA16F,mGLExternal:r.RGBA,mGLType:r.FLOAT}:e===u.TEXFMT.C1F32?{mGLFormat:r.R32F,mGLExternal:r.RED,mGLType:r.FLOAT}:e===u.TEXFMT.C4F32?{mGLFormat:r.RGBA32F,mGLExternal:r.RGBA,mGLType:r.FLOAT}:e===u.TEXFMT.Z16?{mGLFormat:r.DEPTH_COMPONENT16,mGLExternal:r.DEPTH_COMPONENT,mGLType:r.UNSIGNED_SHORT}:e===u.TEXFMT.Z24?{mGLFormat:r.DEPTH_COMPONENT24,mGLExternal:r.DEPTH_COMPONENT,mGLType:r.UNSIGNED_SHORT}:e===u.TEXFMT.Z32?{mGLFormat:r.DEPTH_COMPONENT32F,mGLExternal:r.DEPTH_COMPONENT,mGLType:r.UNSIGNED_SHORT}:null};return u.Initialize=function(n){(r=n).getExtension("OES_texture_float_linear"),r.getExtension("OES_texture_half_float_linear"),e=r.getExtension("EXT_texture_filter_anisotropic"),t=r.getExtension("EXT_color_buffer_float");var u=r.getParameter(r.MAX_TEXTURE_SIZE),U=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),o=r.getParameter(r.MAX_RENDERBUFFER_SIZE),s=(r.getSupportedExtensions(),r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS));console.log("WebGL 2.0 :  Anisotropic Textures: "+(null!==e?"yes":"no")+", Render to 32F: "+(null!==t?"yes":"no")+", Texture Units: "+s+", Max Texture Size: "+u+", Max Render Buffer Size: "+o+", Max Cubemap Size: "+U);var l=new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]);return E=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,E),r.bufferData(r.ARRAY_BUFFER,l,r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),i=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,i),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),T=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,T),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,-1,-1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0,0,-1,1,1,-1,0,0,1,1,-1,1,0,0,1,1,1,1,0,0,1,-1,-1,1,0,0,1,-1,1,1,0,0,1,1,1,0,1,0,1,1,-1,0,1,0,-1,1,1,0,1,0,-1,1,-1,0,1,0,1,-1,-1,0,-1,0,1,-1,1,0,-1,0,-1,-1,-1,0,-1,0,-1,-1,1,0,-1,0,-1,1,1,0,0,1,-1,-1,1,0,0,1,1,1,1,0,0,1,1,-1,1,0,0,1,-1,-1,-1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0,0,-1,1,1,-1,0,0,-1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),a=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,1,-1,1,1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,-1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),R[0]="",m[0]=0,R[0]+="#version 300 es\n#ifdef GL_ES\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\n#endif\n",m[0]+=6,R[1]="",m[1]=0,R[1]+="#version 300 es\n#ifdef GL_ES\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\n#endif\n",m[1]+=6,!0},u.GetShaderHeaderLines=function(e){return m[e]},u.CheckErrors=function(){let e=r.getError();if(e!==r.NO_ERROR)for(let t in r)if("number"==typeof r[t]&&r[t]===e){console.log("GL Error "+e+": "+t);break}},u.Clear=function(e,t,n,E){var i=0;1&e&&(i|=r.COLOR_BUFFER_BIT,r.clearColor(t[0],t[1],t[2],t[3])),2&e&&(i|=r.DEPTH_BUFFER_BIT,r.clearDepth(n)),4&e&&(i|=r.STENCIL_BUFFER_BIT,r.clearStencil(E)),r.clear(i)},u.CreateTexture=function(e,t,n,E,i,T,a){if(null===r)return null;var R=r.createTexture(),m=U(E),o=r.REPEAT;if(T===u.TEXWRP.CLAMP&&(o=r.CLAMP_TO_EDGE),e===u.TEXTYPE.T2D)r.bindTexture(r.TEXTURE_2D,R),r.texImage2D(r.TEXTURE_2D,0,m.mGLFormat,t,n,0,m.mGLExternal,m.mGLType,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,o),i===u.FILTER.NONE?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST)):i===u.FILTER.LINEAR?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)):i===u.FILTER.MIPMAP?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D)),r.bindTexture(r.TEXTURE_2D,null);else{if(e!==u.TEXTYPE.T3D)return null;r.bindTexture(r.TEXTURE_3D,R),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_BASE_LEVEL,0),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAX_LEVEL,Math.log2(t)),i===u.FILTER.NONE?(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,r.NEAREST)):i===u.FILTER.LINEAR?(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,r.LINEAR)):i===u.FILTER.MIPMAP?(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR)):(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_3D)),r.texImage3D(r.TEXTURE_3D,0,m.mGLFormat,t,n,n,0,m.mGLExternal,m.mGLType,a),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_R,o),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_S,o),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_T,o),i===u.FILTER.MIPMAP&&r.generateMipmap(r.TEXTURE_3D),r.bindTexture(r.TEXTURE_3D,null)}return{mObjectID:R,mXres:t,mYres:n,mFormat:E,mType:e,mFilter:i,mWrap:T,mVFlip:!1}},u.CreateTextureFromImage=function(e,t,n,E,i,T){if(null===r)return null;var a=r.createTexture(),R=U(n),m=r.REPEAT;if(i===u.TEXWRP.CLAMP&&(m=r.CLAMP_TO_EDGE),e===u.TEXTYPE.T2D)r.bindTexture(r.TEXTURE_2D,a),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,T),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,R.mGLFormat,R.mGLExternal,R.mGLType,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,m),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,m),E===u.FILTER.NONE?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST)):E===u.FILTER.LINEAR?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)):E===u.FILTER.MIPMAP?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D)),r.bindTexture(r.TEXTURE_2D,null);else{if(e===u.TEXTYPE.T3D)return null;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_CUBE_MAP,a),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,T),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X,0,R.mGLFormat,R.mGLExternal,R.mGLType,t[0]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_X,0,R.mGLFormat,R.mGLExternal,R.mGLType,t[1]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Y,0,R.mGLFormat,R.mGLExternal,R.mGLType,T?t[3]:t[2]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,R.mGLFormat,R.mGLExternal,R.mGLType,T?t[2]:t[3]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Z,0,R.mGLFormat,R.mGLExternal,R.mGLType,t[4]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,R.mGLFormat,R.mGLExternal,R.mGLType,t[5]),E===u.FILTER.NONE?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.NEAREST)):E===u.FILTER.LINEAR?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR)):E===u.FILTER.MIPMAP&&(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_CUBE_MAP)),r.bindTexture(r.TEXTURE_CUBE_MAP,null)}return{mObjectID:a,mXres:t.width,mYres:t.height,mFormat:n,mType:e,mFilter:E,mWrap:i,mVFlip:T}},u.SetSamplerFilter=function(e,t){if(e.mFilter!==t){var n=e.mObjectID;e.mType===u.TEXTYPE.T2D?(r.bindTexture(r.TEXTURE_2D,n),t===u.FILTER.NONE?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST)):t===u.FILTER.LINEAR?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)):t===u.FILTER.MIPMAP?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D)),r.bindTexture(r.TEXTURE_2D,null)):e.mType===u.TEXTYPE.T3D?(r.bindTexture(r.TEXTURE_3D,n),t===u.FILTER.NONE?(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,r.NEAREST)):t===u.FILTER.LINEAR?(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,r.LINEAR)):t===u.FILTER.MIPMAP?(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_3D)):(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_3D)),r.bindTexture(r.TEXTURE_3D,null)):(r.bindTexture(r.TEXTURE_CUBE_MAP,n),t===u.FILTER.NONE?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.NEAREST)):t===u.FILTER.LINEAR?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR)):t===u.FILTER.MIPMAP?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_CUBE_MAP)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_CUBE_MAP)),r.bindTexture(r.TEXTURE_CUBE_MAP,null)),e.mFilter=t}},u.SetSamplerWrap=function(e,t){if(e.mWrap===t)return;let n=r.REPEAT;t===u.TEXWRP.CLAMP&&(n=r.CLAMP_TO_EDGE);let E=e.mObjectID;e.mType===u.TEXTYPE.T2D?(r.bindTexture(r.TEXTURE_2D,E),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n),r.bindTexture(r.TEXTURE_2D,null)):e.mType===u.TEXTYPE.T3D&&(r.bindTexture(r.TEXTURE_3D,E),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_R,n),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_S,n),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_T,n),r.bindTexture(r.TEXTURE_3D,null)),e.mWrap=t},u.SetSamplerVFlip=function(e,t,n){if(e.mVFlip===t)return;let E=e.mObjectID;if(e.mType===u.TEXTYPE.T2D){if(null!==n){r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,E),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t);let i=U(e.mFormat);r.texImage2D(r.TEXTURE_2D,0,i.mGLFormat,i.mGLExternal,i.mGLType,n),r.bindTexture(r.TEXTURE_2D,null)}}else if(e.mType===u.TEXTYPE.CUBEMAP&&null!==n){let i=U(e.mFormat);r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_CUBE_MAP,E),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X,0,i.mGLFormat,i.mGLExternal,i.mGLType,n[0]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_X,0,i.mGLFormat,i.mGLExternal,i.mGLType,n[1]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Y,0,i.mGLFormat,i.mGLExternal,i.mGLType,t?n[3]:n[2]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,i.mGLFormat,i.mGLExternal,i.mGLType,t?n[2]:n[3]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Z,0,i.mGLFormat,i.mGLExternal,i.mGLType,n[4]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,i.mGLFormat,i.mGLExternal,i.mGLType,n[5]),r.bindTexture(r.TEXTURE_CUBE_MAP,null)}e.mVFlip=t},u.CreateMipmaps=function(e){e.mType===u.TEXTYPE.T2D?(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e.mObjectID),r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null)):e.mType===u.TEXTYPE.CUBEMAP&&(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_CUBE_MAP,e.mObjectID),r.generateMipmap(r.TEXTURE_CUBE_MAP),r.bindTexture(r.TEXTURE_CUBE_MAP,null))},u.UpdateTexture=function(e,t,n,E,i,T){var a=U(e.mFormat);e.mType===u.TEXTYPE.T2D&&(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e.mObjectID),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.mVFlip),r.texSubImage2D(r.TEXTURE_2D,0,t,n,E,i,a.mGLExternal,a.mGLType,T),r.bindTexture(r.TEXTURE_2D,null))},u.UpdateTextureFromImage=function(e,t){var n=U(e.mFormat);e.mType===u.TEXTYPE.T2D&&(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e.mObjectID),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.mVFlip),r.texImage2D(r.TEXTURE_2D,0,n.mGLFormat,n.mGLExternal,n.mGLType,t),r.bindTexture(r.TEXTURE_2D,null))},u.DestroyTexture=function(e){r.deleteTexture(e.mObjectID)},u.AttachTextures=function(e,t,n,E,i){e>0&&null!==t&&(r.activeTexture(r.TEXTURE0),t.mType===u.TEXTYPE.T2D?r.bindTexture(r.TEXTURE_2D,t.mObjectID):t.mType===u.TEXTYPE.T3D?r.bindTexture(r.TEXTURE_3D,t.mObjectID):t.mType===u.TEXTYPE.CUBEMAP&&r.bindTexture(r.TEXTURE_CUBE_MAP,t.mObjectID)),e>1&&null!==n&&(r.activeTexture(r.TEXTURE1),n.mType===u.TEXTYPE.T2D?r.bindTexture(r.TEXTURE_2D,n.mObjectID):n.mType===u.TEXTYPE.T3D?r.bindTexture(r.TEXTURE_3D,n.mObjectID):n.mType===u.TEXTYPE.CUBEMAP&&r.bindTexture(r.TEXTURE_CUBE_MAP,n.mObjectID)),e>2&&null!==E&&(r.activeTexture(r.TEXTURE2),E.mType===u.TEXTYPE.T2D?r.bindTexture(r.TEXTURE_2D,E.mObjectID):E.mType===u.TEXTYPE.T3D?r.bindTexture(r.TEXTURE_3D,E.mObjectID):E.mType===u.TEXTYPE.CUBEMAP&&r.bindTexture(r.TEXTURE_CUBE_MAP,E.mObjectID)),e>3&&null!==i&&(r.activeTexture(r.TEXTURE3),i.mType===u.TEXTYPE.T2D?r.bindTexture(r.TEXTURE_2D,i.mObjectID):i.mType===u.TEXTYPE.T3D?r.bindTexture(r.TEXTURE_3D,i.mObjectID):i.mType===u.TEXTYPE.CUBEMAP&&r.bindTexture(r.TEXTURE_CUBE_MAP,i.mObjectID))},u.DettachTextures=function(){r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,null),r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,null),r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,null),r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,null),r.bindTexture(r.TEXTURE_CUBE_MAP,null)},u.CreateRenderTarget=function(e,t,n,E,i,T){var a=r.createFramebuffer();if(r.bindFramebuffer(r.FRAMEBUFFER,a),null===i){if(!0===T){var R=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,R),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.mXres,e.mYres),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,R)}}else r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,i.mObjectID,0);return null!==e&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.mObjectID,0),r.checkFramebufferStatus(r.FRAMEBUFFER)!==r.FRAMEBUFFER_COMPLETE?null:(r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),{mObjectID:a,mTex0:e})},u.DestroyRenderTarget=function(e){r.deleteFramebuffer(e.mObjectID)},u.SetRenderTarget=function(e){null===e?r.bindFramebuffer(r.FRAMEBUFFER,null):r.bindFramebuffer(r.FRAMEBUFFER,e.mObjectID)},u.CreateRenderTargetNew=function(e,t,n,E,i){var T=r.createFramebuffer();if(r.bindFramebuffer(r.FRAMEBUFFER,T),!0===t){var a=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,a),1===i?r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,n,E):r.renderbufferStorageMultisample(r.RENDERBUFFER,i,r.DEPTH_COMPONENT16,n,E),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,a)}if(e){var R=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,R),1==i?r.renderbufferStorage(r.RENDERBUFFER,r.RGBA8,n,E):r.renderbufferStorageMultisample(r.RENDERBUFFER,i,r.RGBA8,n,E),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,R)}return r.checkFramebufferStatus(r.FRAMEBUFFER)!=r.FRAMEBUFFER_COMPLETE?null:(r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),{mObjectID:T,mXres:n,mYres:E})},u.CreateRenderTargetCubeMap=function(e,t,n){var E=r.createFramebuffer();if(r.bindFramebuffer(r.FRAMEBUFFER,E),null===t){if(!0===n){var i=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,i),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.mXres,e.mYres),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,i)}}else r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,t.mObjectID,0);return null!==e&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X,e.mObjectID,0),r.checkFramebufferStatus(r.FRAMEBUFFER)!==r.FRAMEBUFFER_COMPLETE?null:(r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),{mObjectID:E,mTex0:e})},u.SetRenderTargetCubeMap=function(e,t){null===e?r.bindFramebuffer(r.FRAMEBUFFER,null):(r.bindFramebuffer(r.FRAMEBUFFER,e.mObjectID),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.mTex0.mObjectID,0))},u.BlitRenderTarget=function(e,t){r.bindFramebuffer(r.READ_FRAMEBUFFER,t.mObjectID),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e.mObjectID),r.clearBufferfv(r.COLOR,0,[0,0,0,1]),r.blitFramebuffer(0,0,t.mXres,t.mYres,0,0,t.mXres,t.mYres,r.COLOR_BUFFER_BIT,r.LINEAR)},u.SetViewport=function(e){r.viewport(e[0],e[1],e[2],e[3])},u.SetWriteMask=function(e,t,n,E,i){r.depthMask(i),r.colorMask(e,e,e,e)},u.SetState=function(e,t){e===u.RENDSTGATE.WIREFRAME?t?r.polygonMode(r.FRONT_AND_BACK,r.LINE):r.polygonMode(r.FRONT_AND_BACK,r.FILL):e===u.RENDSTGATE.FRONT_FACE?t?r.cullFace(r.BACK):r.cullFace(r.FRONT):e===u.RENDSTGATE.CULL_FACE?t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE):e===u.RENDSTGATE.DEPTH_TEST?t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST):e===u.RENDSTGATE.ALPHA_TO_COVERAGE&&(t?r.enable(r.SAMPLE_ALPHA_TO_COVERAGE):r.disable(r.SAMPLE_ALPHA_TO_COVERAGE))},u.SetMultisample=function(e){!0===e?(r.enable(r.SAMPLE_COVERAGE),r.sampleCoverage(1,!1)):r.disable(r.SAMPLE_COVERAGE)},u.CreateShader=function(e,t){if(null===r)return{mProgram:null,mResult:!1,mInfo:"No WebGL",mHeaderLines:0};let n={mProgram:null,mResult:!0,mInfo:"Shader compiled successfully",mHeaderLines:0,mErrorType:0},E=r.createShader(r.VERTEX_SHADER),i=r.createShader(r.FRAGMENT_SHADER);if(e=R[0]+e,t=R[1]+t,r.shaderSource(E,e),r.shaderSource(i,t),r.compileShader(E),r.compileShader(i),!r.getShaderParameter(E,r.COMPILE_STATUS)){let e=r.getShaderInfoLog(E);return n.mInfo=e,n.mErrorType=0,n.mResult=!1,n}if(!r.getShaderParameter(i,r.COMPILE_STATUS)){let e=r.getShaderInfoLog(i);return n.mInfo=e,n.mErrorType=1,n.mResult=!1,n}if(n.mProgram=r.createProgram(),r.attachShader(n.mProgram,E),r.attachShader(n.mProgram,i),r.linkProgram(n.mProgram),!r.getProgramParameter(n.mProgram,r.LINK_STATUS)){let e=r.getProgramInfoLog(n.mProgram);return r.deleteProgram(n.mProgram),n.mInfo=e,n.mErrorType=2,n.mResult=!1,n}return n},u.AttachShader=function(e){null===e?(n=null,r.useProgram(null)):(n=e,r.useProgram(e.mProgram))},u.DetachShader=function(){r.useProgram(null)},u.DestroyShader=function(e){r.deleteProgram(e.mProgram)},u.GetAttribLocation=function(e,t){return r.getAttribLocation(e.mProgram,t)},u.SetShaderConstantLocation=function(e,t){return r.getUniformLocation(e.mProgram,t)},u.SetShaderConstantMat4F=function(e,t,E){var i=n,T=r.getUniformLocation(i.mProgram,e);if(null===T)return!1;if(!1===E){var a=new Float32Array([t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]);r.uniformMatrix4fv(T,!1,a)}else r.uniformMatrix4fv(T,!1,new Float32Array(t));return!0},u.SetShaderConstant1F_Pos=function(e,t){return r.uniform1f(e,t),!0},u.SetShaderConstant1FV_Pos=function(e,t){return r.uniform1fv(e,t),!0},u.SetShaderConstant1F=function(e,t){var E=r.getUniformLocation(n.mProgram,e);return null!==E&&(r.uniform1f(E,t),!0)},u.SetShaderConstant1I=function(e,t){var E=r.getUniformLocation(n.mProgram,e);return null!==E&&(r.uniform1i(E,t),!0)},u.SetShaderConstant2F=function(e,t){var E=r.getUniformLocation(n.mProgram,e);return null!==E&&(r.uniform2fv(E,t),!0)},u.SetShaderConstant3F=function(e,t,E,i){var T=r.getUniformLocation(n.mProgram,e);return null!==T&&(r.uniform3f(T,t,E,i),!0)},u.SetShaderConstant1FV=function(e,t){var E=r.getUniformLocation(n.mProgram,e);return null!==E&&(r.uniform1fv(E,new Float32Array(t)),!0)},u.SetShaderConstant3FV=function(e,t){var E=r.getUniformLocation(n.mProgram,e);return null!==E&&(r.uniform3fv(E,new Float32Array(t)),!0)},u.SetShaderConstant4FV=function(e,t){var E=r.getUniformLocation(n.mProgram,e);return null!==E&&(r.uniform4fv(E,new Float32Array(t)),!0)},u.SetShaderTextureUnit=function(e,t){var E=n,i=r.getUniformLocation(E.mProgram,e);return null!==i&&(r.uniform1i(i,t),!0)},u.CreateVertexArray=function(e,t){var n=r.createBuffer();return r.bindBuffer(r.ARRAY_BUFFER,n),t===u.BUFTYPE.STATIC?r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW):r.bufferData(r.ARRAY_BUFFER,e,r.DYNAMIC_DRAW),{mObject:n}},u.CreateIndexArray=function(e,t){var n=r.createBuffer();return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n),t===u.BUFTYPE.STATIC?r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW):r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.DYNAMIC_DRAW),{mObject:n}},u.DestroyArray=function(e){r.destroyBuffer(e.mObject)},u.AttachVertexArray=function(e,t,n){r.bindBuffer(r.ARRAY_BUFFER,e.mObject);for(var E=t.mChannels.length,i=t.mStride,T=0,a=0;a<E;a++){var R=n[a];r.enableVertexAttribArray(R);var m=r.FLOAT,U=4;t.mChannels[a].mType===u.TYPE.UINT8?(m=r.UNSIGNED_BYTE,U=1):t.mChannels[a].mType===u.TYPE.UINT16?(m=r.UNSIGNED_SHORT,U=2):t.mChannels[a].mType===u.TYPE.FLOAT32&&(m=r.FLOAT,U=4),r.vertexAttribPointer(R,t.mChannels[a].mNumComponents,m,t.mChannels[a].mNormalize,i,T),T+=t.mChannels[a].mNumComponents*U}},u.AttachIndexArray=function(e){r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.mObject)},u.DetachVertexArray=function(e,t){for(var n=t.mChannels.length,E=0;E<n;E++)r.disableVertexAttribArray(E);r.bindBuffer(r.ARRAY_BUFFER,null)},u.DetachIndexArray=function(e){r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)},u.DrawPrimitive=function(e,t,n,E){var i=r.POINTS;e===u.PRIMTYPE.POINTS&&(i=r.POINTS),e===u.PRIMTYPE.LINES&&(i=r.LINES),e===u.PRIMTYPE.LINE_LOOP&&(i=r.LINE_LOOP),e===u.PRIMTYPE.LINE_STRIP&&(i=r.LINE_STRIP),e===u.PRIMTYPE.TRIANGLES&&(i=r.TRIANGLES),e===u.PRIMTYPE.TRIANGLE_STRIP&&(i=r.TRIANGLE_STRIP),E<=1?n?r.drawElements(i,t,r.UNSIGNED_SHORT,0):r.drawArrays(i,0,t):(r.drawArraysInstanced(i,0,t,E),r.drawElementsInstanced(i,t,r.UNSIGNED_SHORT,0,E))},u.DrawFullScreenTriangle_XY=function(e){r.bindBuffer(r.ARRAY_BUFFER,i),r.vertexAttribPointer(e,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(e),r.drawArrays(r.TRIANGLES,0,3),r.disableVertexAttribArray(e),r.bindBuffer(r.ARRAY_BUFFER,null)},u.DrawUnitQuad_XY=function(e){r.bindBuffer(r.ARRAY_BUFFER,E),r.vertexAttribPointer(e,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(e),r.drawArrays(r.TRIANGLES,0,6),r.disableVertexAttribArray(e),r.bindBuffer(r.ARRAY_BUFFER,null)},u.DrawUnitCube_XYZ_NOR=function(e){r.bindBuffer(r.ARRAY_BUFFER,T),r.vertexAttribPointer(e[0],3,r.FLOAT,!1,0,0),r.vertexAttribPointer(e[1],3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(e[0]),r.enableVertexAttribArray(e[1]),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.drawArrays(r.TRIANGLE_STRIP,4,4),r.drawArrays(r.TRIANGLE_STRIP,8,4),r.drawArrays(r.TRIANGLE_STRIP,12,4),r.drawArrays(r.TRIANGLE_STRIP,16,4),r.drawArrays(r.TRIANGLE_STRIP,20,4),r.disableVertexAttribArray(e[0]),r.disableVertexAttribArray(e[1]),r.bindBuffer(r.ARRAY_BUFFER,null)},u.DrawUnitCube_XYZ=function(e){r.bindBuffer(r.ARRAY_BUFFER,a),r.vertexAttribPointer(e,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(e),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.drawArrays(r.TRIANGLE_STRIP,4,4),r.drawArrays(r.TRIANGLE_STRIP,8,4),r.drawArrays(r.TRIANGLE_STRIP,12,4),r.drawArrays(r.TRIANGLE_STRIP,16,4),r.drawArrays(r.TRIANGLE_STRIP,20,4),r.disableVertexAttribArray(e),r.bindBuffer(r.ARRAY_BUFFER,null)},u.SetBlend=function(e){e?(r.enable(r.BLEND),r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.disable(r.BLEND)},u.GetPixelData=function(e,t,n,E){r.readPixels(0,0,n,E,r.RGBA,r.UNSIGNED_BYTE,e,t)},u.GetPixelDataRenderTarget=function(e,t,n,E){r.bindFramebuffer(r.FRAMEBUFFER,e.mObjectID),r.readBuffer(r.COLOR_ATTACHMENT0),r.readPixels(0,0,n,E,r.RGBA,r.FLOAT,t,0),r.bindFramebuffer(r.FRAMEBUFFER,null)},u}function smoothstep(e,t,r){return(r=(r-e)/(t-e))<0?r=0:r>1&&(r=1),r*r*(3-2*r)}function clamp01(e){return e<0&&(e=0),e>1&&(e=1),e}function clamp(e,t,r){return e<t&&(e=t),e>r&&(e=r),e}function screen(e,t){return 1-(1-e)*(1-t)}function parabola(e){return 4*e*(1-e)}function min(e,t){return e<t?e:t}function max(e,t){return e>t?e:t}function noise(e){function t(e,t,r,n){var E=7*e+131*t;return(536870912&(E=(E^=E<<13)*(E*E*15731+789221)+1376312589)?r:-r)+(268435456&E?n:-n)}var r=[Math.floor(e[0]),Math.floor(e[1])],n=[e[0]-r[0],e[1]-r[1]],E=[n[0]*n[0]*(3-2*n[0]),n[1]*n[1]*(3-2*n[1])],i=t(r[0]+0,r[1]+0,n[0]+0,n[1]+0),T=t(r[0]+1,r[1]+0,n[0]-1,n[1]+0),a=t(r[0]+0,r[1]+1,n[0]+0,n[1]-1),R=t(r[0]+1,r[1]+1,n[0]-1,n[1]-1);return i+(T-i)*E[0]+(a-i)*E[1]+(i-T-a+R)*E[0]*E[1]}function vec3(e,t,r){return[e,t,r]}function add(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function sub(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function mul(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function cross(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function normalize(e){var t=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]*t,e[1]*t,e[2]*t]}function createCirclePoint(e,t,r,n,E,i){return[e[0]+n*(t[0]*E+r[0]*i),e[1]+n*(t[1]*E+r[1]*i),e[2]+n*(t[2]*E+r[2]*i)]}function createTangent(e,t,r){var n=normalize([r[0]-t[0],r[1]-t[1],r[2]-t[2]]),E=normalize([t[0]-e[0],t[1]-e[1],t[2]-e[2]]);return normalize([E[0]+n[0],E[1]+n[1],E[2]+n[2]])}function vec4(e,t,r,n){return[e,t,r,n]}function getXYZ(e){return[e[0],e[1],e[2]]}function setIdentity(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function setRotationX(e){var t=Math.sin(e),r=Math.cos(e);return[1,0,0,0,0,r,-t,0,0,t,r,0,0,0,0,1]}function setRotationY(e){var t=Math.sin(e),r=Math.cos(e);return[r,0,-t,0,0,1,0,0,t,0,r,0,0,0,0,1]}function extractRotationEuler(e){var t=[];return 1==e[0]?(t[0]=Math.atan2(e[2],e[11]),t[1]=0,t[2]=0):-1==e[0]?(t[0]=Math.atan2(e[2],e[11]),t[1]=0,t[2]=0):(t[0]=Math.atan2(-e[9],e[10]),t[1]=Math.atan2(e[8],Math.sqrt(e[9]*e[9]+e[10]*e[10])),t[2]=Math.atan2(e[4],e[0])),t}function setFromQuaternion(e){var t=e[3]*e[3],r=e[0]*e[0],n=e[1]*e[1],E=e[2]*e[2];return[t+r-n-E,2*(e[0]*e[1]-e[3]*e[2]),2*(e[0]*e[2]+e[3]*e[1]),0,2*(e[0]*e[1]+e[3]*e[2]),t-r+n-E,2*(e[1]*e[2]-e[3]*e[0]),0,2*(e[0]*e[2]-e[3]*e[1]),2*(e[1]*e[2]+e[3]*e[0]),t-r-n+E,0,0,0,0,1]}function setPerspective(e,t,r,n){var E=Math.tan(e*Math.PI/180);return[1/(E*t),0,0,0,0,1/E,0,0,0,0,-(n+r)/(n-r),-2*n*r/(n-r),0,0,-1,0]}function setLookAt(e,t,r){var n=[-t[0]+e[0],-t[1]+e[1],-t[2]+e[2]],E=n[2]*r[1]-n[1]*r[2],i=n[0]*r[2]-n[2]*r[0],T=n[1]*r[0]-n[0]*r[1],a=1/Math.sqrt(E*E+i*i+T*T),R=(T*=a)*n[1]-(i*=a)*n[2],m=(E*=a)*n[2]-T*n[0],u=i*n[0]-E*n[1];R*=a=1/Math.sqrt(R*R+m*m+u*u),m*=a,u*=a;var U=n[0],o=n[1],s=n[2];return U*=a=1/Math.sqrt(U*U+o*o+s*s),o*=a,s*=a,[E,i,T,-(E*e[0]+i*e[1]+T*e[2]),R,m,u,-(R*e[0]+m*e[1]+u*e[2]),U,o,s,-(U*e[0]+o*e[1]+s*e[2]),0,0,0,1]}function setOrtho(e,t,r,n,E,i){return[2/(t-e),0,0,(t+e)/(t-e),0,2/(n-r),0,(n+r)/(n-r),0,0,-2/(i-E),-(i+E)/(i-E),0,0,0,1]}function setTranslation(e){return[1,0,0,e[0],0,1,0,e[1],0,0,1,e[2],0,0,0,1]}function setScale(e){return[e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,1]}function setProjection(e,t,r){var n=2/(e[3]+e[2]),E=2/(e[0]+e[1]);return[n,0,(e[3]-e[2])/(e[3]+e[2]),0,0,E,(e[0]-e[1])/(e[0]+e[1]),0,0,0,-(r+t)/(r-t),-2*r*t/(r-t),0,0,-1,0]}function invertFast(e){var t=[e[5]*e[10]*e[15]-e[5]*e[11]*e[14]-e[9]*e[6]*e[15]+e[9]*e[7]*e[14]+e[13]*e[6]*e[11]-e[13]*e[7]*e[10],-e[1]*e[10]*e[15]+e[1]*e[11]*e[14]+e[9]*e[2]*e[15]-e[9]*e[3]*e[14]-e[13]*e[2]*e[11]+e[13]*e[3]*e[10],e[1]*e[6]*e[15]-e[1]*e[7]*e[14]-e[5]*e[2]*e[15]+e[5]*e[3]*e[14]+e[13]*e[2]*e[7]-e[13]*e[3]*e[6],-e[1]*e[6]*e[11]+e[1]*e[7]*e[10]+e[5]*e[2]*e[11]-e[5]*e[3]*e[10]-e[9]*e[2]*e[7]+e[9]*e[3]*e[6],-e[4]*e[10]*e[15]+e[4]*e[11]*e[14]+e[8]*e[6]*e[15]-e[8]*e[7]*e[14]-e[12]*e[6]*e[11]+e[12]*e[7]*e[10],e[0]*e[10]*e[15]-e[0]*e[11]*e[14]-e[8]*e[2]*e[15]+e[8]*e[3]*e[14]+e[12]*e[2]*e[11]-e[12]*e[3]*e[10],-e[0]*e[6]*e[15]+e[0]*e[7]*e[14]+e[4]*e[2]*e[15]-e[4]*e[3]*e[14]-e[12]*e[2]*e[7]+e[12]*e[3]*e[6],e[0]*e[6]*e[11]-e[0]*e[7]*e[10]-e[4]*e[2]*e[11]+e[4]*e[3]*e[10]+e[8]*e[2]*e[7]-e[8]*e[3]*e[6],e[4]*e[9]*e[15]-e[4]*e[11]*e[13]-e[8]*e[5]*e[15]+e[8]*e[7]*e[13]+e[12]*e[5]*e[11]-e[12]*e[7]*e[9],-e[0]*e[9]*e[15]+e[0]*e[11]*e[13]+e[8]*e[1]*e[15]-e[8]*e[3]*e[13]-e[12]*e[1]*e[11]+e[12]*e[3]*e[9],e[0]*e[5]*e[15]-e[0]*e[7]*e[13]-e[4]*e[1]*e[15]+e[4]*e[3]*e[13]+e[12]*e[1]*e[7]-e[12]*e[3]*e[5],-e[0]*e[5]*e[11]+e[0]*e[7]*e[9]+e[4]*e[1]*e[11]-e[4]*e[3]*e[9]-e[8]*e[1]*e[7]+e[8]*e[3]*e[5],-e[4]*e[9]*e[14]+e[4]*e[10]*e[13]+e[8]*e[5]*e[14]-e[8]*e[6]*e[13]-e[12]*e[5]*e[10]+e[12]*e[6]*e[9],e[0]*e[9]*e[14]-e[0]*e[10]*e[13]-e[8]*e[1]*e[14]+e[8]*e[2]*e[13]+e[12]*e[1]*e[10]-e[12]*e[2]*e[9],-e[0]*e[5]*e[14]+e[0]*e[6]*e[13]+e[4]*e[1]*e[14]-e[4]*e[2]*e[13]-e[12]*e[1]*e[6]+e[12]*e[2]*e[5],e[0]*e[5]*e[10]-e[0]*e[6]*e[9]-e[4]*e[1]*e[10]+e[4]*e[2]*e[9]+e[8]*e[1]*e[6]-e[8]*e[2]*e[5]],r=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12];r=1/r;for(var n=0;n<16;n++)t[n]=t[n]*r;return t}function matMul(e,t){for(var r=[],n=0;n<4;n++){var E=e[4*n+0],i=e[4*n+1],T=e[4*n+2],a=e[4*n+3];r[4*n+0]=E*t[0]+i*t[4]+T*t[8]+a*t[12],r[4*n+1]=E*t[1]+i*t[5]+T*t[9]+a*t[13],r[4*n+2]=E*t[2]+i*t[6]+T*t[10]+a*t[14],r[4*n+3]=E*t[3]+i*t[7]+T*t[11]+a*t[15]}return r}function matMulpoint(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]]}function matMulvec(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[4]*t[0]+e[5]*t[1]+e[6]*t[2],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]]}function bound3(e){return[e,-e,e,-e,e,-e]}function bound3_include(e,t){return[t[0]<e[0]?t[0]:e[0],t[0]>e[1]?t[0]:e[1],t[1]<e[2]?t[1]:e[2],t[1]>e[3]?t[1]:e[3],t[2]<e[4]?t[2]:e[4],t[2]>e[5]?t[2]:e[5]]}function bound3_center(e){return[.5*(e[0]+e[1]),.5*(e[2]+e[3]),.5*(e[4]+e[5])]}function bound3_radius(e){return[.5*(e[1]-e[0]),.5*(e[3]-e[2]),.5*(e[5]-e[4])]}function WebVR(e,t){this.mSupportVR=!1,this.mHMD=null,this.mHMDSensor=null;var r=this,n=function(t){for(var n=0;n<t.length;n++)if(t[n]instanceof HMDVRDevice){r.mHMD=t[n];break}for(n=0;n<t.length;n++)if(t[n]instanceof PositionSensorVRDevice&&t[n].hardwareUnitId==r.mHMD.hardwareUnitId){r.mHMDSensor=t[n];break}e(!0),r.mSupportVR=!0};navigator.getVRDevices?navigator.getVRDevices().then(n):navigator.mozGetVRDevices?navigator.mozGetVRDevices(n):console.log("No WebVR!"),e(!1),this.mCanvas=t}function htmlEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function piDisableTouch(){document.body.addEventListener("touchstart",function(e){e.preventDefault()})}piMesh.prototype.createCube=function(e){return this.mPrimitiveType=0,this.mChunks[0]={mVerts:new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),mIndices:new Uint16Array([0,2,1,1,2,3,5,1,3,5,3,7,4,5,7,4,7,6,4,6,2,4,2,0,6,7,3,6,3,2,4,0,1,4,1,5]),mNumVertices:8,mNumFaces:12,mTransform:setIdentity(),mVBO:null,mIBO:null},this.mVertexFormat={mStride:12,mChannels:[{mNumComponents:3,mType:e.TYPE.FLOAT32,mNormalize:!1}]},!0},piMesh.prototype.createCubeSharp=function(e){return this.mPrimitiveType=0,this.mChunks[0]={mVerts:new Float32Array([-1,1,-1,0,1,0,0,0,-1,1,1,0,1,0,0,1,1,1,1,0,1,0,1,1,1,1,-1,0,1,0,1,0,-1,-1,1,0,0,1,0,0,1,-1,1,0,0,1,0,1,1,1,1,0,0,1,1,1,-1,1,1,0,0,1,1,0,1,1,1,1,0,0,0,0,1,-1,1,1,0,0,0,1,1,-1,-1,1,0,0,1,1,1,1,-1,1,0,0,1,0,1,-1,-1,0,0,-1,0,0,-1,-1,-1,0,0,-1,0,1,-1,1,-1,0,0,-1,1,1,1,1,-1,0,0,-1,1,0,-1,-1,1,0,-1,0,0,0,-1,-1,-1,0,-1,0,0,1,1,-1,-1,0,-1,0,1,1,1,-1,1,0,-1,0,1,0,-1,1,1,-1,0,0,0,0,-1,1,-1,-1,0,0,0,1,-1,-1,-1,-1,0,0,1,1,-1,-1,1,-1,0,0,1,0]),mIndices:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),mNumVertices:24,mNumFaces:12,mTransform:setIdentity(),mVBO:null,mIBO:null},this.mVertexFormat={mStride:32,mChannels:[{mNumComponents:3,mType:e.TYPE.FLOAT32,mNormalize:!1},{mNumComponents:3,mType:e.TYPE.FLOAT32,mNormalize:!1},{mNumComponents:2,mType:e.TYPE.FLOAT32,mNormalize:!1}]},!0},piMesh.prototype.createUnitQuad=function(e){return this.mPrimitiveType=0,this.mVertexFormat={mStride:8,mChannels:[{mNumComponents:2,mType:e.TYPE.FLOAT32,mNormalize:!1}]},this.mChunks[0]={mVerts:new Float32Array([-1,-1,1,-1,-1,1,1,1]),mIndices:new Uint16Array([0,2,1,1,2,3]),mNumVertices:4,mNumFaces:2,mTransform:setIdentity(),mVBO:null,mIBO:null},!0},piMesh.prototype.destroy=function(){},piMesh.prototype.scale=function(e,t,r){for(var n=this.mVertexFormat.mStride/4,E=0;E<this.mChunks.length;E++)for(var i=this.mChunks[E].mNumVertices,T=0;T<i;T++)this.mChunks[E].mVerts[n*T+0]*=e,this.mChunks[E].mVerts[n*T+1]*=t,this.mChunks[E].mVerts[n*T+2]*=r},piMesh.prototype.translate=function(e,t,r){for(var n=this.mVertexFormat.mStride/4,E=0;E<this.mChunks.length;E++)for(var i=this.mChunks[E].mNumVertices,T=0;T<i;T++)this.mChunks[E].mVerts[n*T+0]+=e,this.mChunks[E].mVerts[n*T+1]+=t,this.mChunks[E].mVerts[n*T+2]+=r},piMesh.prototype.GPULoad=function(e){for(var t=0;t<this.mChunks.length;t++){var r=e.CreateVertexArray(this.mChunks[t].mVerts,e.BUFTYPE.STATIC);if(null==r)return!1;var n=e.CreateIndexArray(this.mChunks[t].mIndices,e.BUFTYPE.STATIC);if(null==n)return!1;this.mChunks[t].mVBO=r,this.mChunks[t].mIBO=n}return!0},piMesh.prototype.GPURender=function(e,t){for(var r=this.mChunks.length,n=0;n<r;n++)e.AttachVertexArray(this.mChunks[n].mVBO,this.mVertexFormat,t),e.AttachIndexArray(this.mChunks[n].mIBO),e.DrawPrimitive(e.PRIMTYPE.TRIANGLES,3*this.mChunks[n].mNumFaces,!0,1),e.DetachIndexArray(this.mChunks[n].mIBO),e.DetachVertexArray(this.mChunks[n].mVBO,this.mVertexFormat)},WebVR.prototype.IsSupported=function(){return this.mSupportVR},WebVR.prototype.GetData=function(e){var t=this.mHMDSensor.getState(),r=this.mHMD.getEyeParameters("left"),n=this.mHMD.getEyeParameters("right"),E=vec3(0,0,0);t.position&&(E=vec3(-t.position.x,-t.position.y,-t.position.z));var i=setFromQuaternion(vec4(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)),T=setTranslation(E),a=matMul(invertFast(i),T),R=matMul(setTranslation(vec3(-r.eyeTranslation.x,-r.eyeTranslation.y,-r.eyeTranslation.z)),a),m=[Math.tan(r.recommendedFieldOfView.upDegrees*Math.PI/180),Math.tan(r.recommendedFieldOfView.downDegrees*Math.PI/180),Math.tan(r.recommendedFieldOfView.leftDegrees*Math.PI/180),Math.tan(r.recommendedFieldOfView.rightDegrees*Math.PI/180)],u=matMul(setTranslation(vec3(-n.eyeTranslation.x,-n.eyeTranslation.y,-n.eyeTranslation.z)),a),U=[Math.tan(n.recommendedFieldOfView.upDegrees*Math.PI/180),Math.tan(n.recommendedFieldOfView.downDegrees*Math.PI/180),Math.tan(n.recommendedFieldOfView.leftDegrees*Math.PI/180),Math.tan(n.recommendedFieldOfView.rightDegrees*Math.PI/180)];return{mCamera:{mCamera:a},mLeftEye:{mVP:[r.renderRect.x,r.renderRect.y,r.renderRect.width,r.renderRect.height],mProjection:m,mCamera:R},mRightEye:{mVP:[n.renderRect.x,n.renderRect.y,n.renderRect.width,n.renderRect.height],mProjection:U,mCamera:u}}},WebVR.prototype.Enable=function(e){this.mCanvas.mozRequestFullScreen?this.mCanvas.mozRequestFullScreen({vrDisplay:this.mHMD}):this.mCanvas.webkitRequestFullscreen?this.mCanvas.webkitRequestFullscreen({vrDisplay:this.mHMD}):console.log("Couldn't switch to fullscreen VR")},WebVR.prototype.Disable=function(e){},window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},window.getRealTime="performance"in window?function(){return window.performance.now()}:function(){return(new Date).getTime()},window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var piGetTime=function(e){var t=new Array;t[0]="Jan",t[1]="Feb",t[2]="Mar",t[3]="Apr",t[4]="May",t[5]="Jun",t[6]="Jul",t[7]="Aug",t[8]="Sep",t[9]="Oct",t[10]="Nov",t[11]="Dec";let r=new Date(1e3*e);return r.getFullYear()+"-"+t[r.getMonth()]+"-"+r.getDate()};function piGetCoords(e){var t=0,r=0;do{t+=e.offsetLeft,r+=e.offsetTop}while(e=e.offsetParent);return{mX:t,mY:r}}function piGetMouseCoords(e,t){var r=piGetCoords(t);return{mX:(e.pageX-r.mX)*t.width/t.offsetWidth,mY:t.height-(e.pageY-r.mY)*t.height/t.offsetHeight}}function piGetSourceElement(e){var t=null;return e.target&&(t=e.target),e.srcElement&&(t=e.srcElement),t}function piRequestFullScreen(e){null===e&&(e=document.documentElement),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function piIsFullScreen(){return document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||!1}function piExitFullScreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function piCreateGlContext(e,t,r,n,E){var i={alpha:t,depth:r,stencil:!1,premultipliedAlpha:!1,antialias:E,preserveDrawingBuffer:n,powerPreference:"high-performance"},T=null;return null===T&&(T=e.getContext("webgl2",i)),null===T&&(T=e.getContext("experimental-webgl2",i)),null===T&&(T=e.getContext("webgl",i)),null===T&&(T=e.getContext("experimental-webgl",i)),T}function piCreateAudioContext(){var e=null;try{window.AudioContext&&(e=new AudioContext),null===e&&window.webkitAudioContext&&(e=new webkitAudioContext)}catch(t){e=null}return e}function piHexColorToRGB(e){var t=parseInt(e.slice(1),16);return[t>>16&255,t>>8&255,t>>0&255]}function piCreateFPSCounter(){var e,t,r;return{Reset:function(n){e=0,t=n,r=60},Count:function(n){return e++,n-t>500&&(r=1e3*e/(n-t),e=0,t=n,!0)},GetFPS:function(){return r}}}function piCanMediaRecorded(e){return"function"==typeof window.MediaRecorder&&"function"==typeof e.captureStream}function piCreateMediaRecorder(e,t){if(0==piCanMediaRecorded(t))return null;var r=new MediaRecorder(t.captureStream()),n=[];return r.ondataavailable=function(e){e.data.size>0&&n.push(e.data)},r.onstart=function(){e(!0)},r.onstop=function(){e(!1);let t=new Blob(n,{type:"video/webm"});n=[];window.URL.createObjectURL(t);let r=window.URL.createObjectURL(t),E=document.createElement("a");document.body.appendChild(E),E.style="display: none",E.href=r,E.download="capture.webm",E.click(),window.URL.revokeObjectURL(r)},r}function piTriggerDownload(e,t){let r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.target="_self",n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}